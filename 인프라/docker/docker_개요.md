# 도커
- 왜 가상화하는걸까
- 하이퍼바이저의 가상화 기술과 컨테이너의 차이

---

## 왜 도커라는게 사용되는걸까?

### 니즈 - 리소스 낭비 해결

한 개의 컴퓨터에 하나의 OS만 실행하는 경우 리소스가 낭비된다. 하나의 OS가 하드웨어 자원을 모두 활용하는 경우는 드물기 때문이다.

사용할 수 있는데 사용 못하는 상황. 단편화 문제와 유사하다. 사용 가능한 컴퓨터 자원이 분명 존재하지만, 하드웨어 리소스를 모두 활용하지 못하는 하나의 OS가 하드웨어 리소스를 독점하면서 실제로 많은 리소스가 유휴 상태로 낭비될 수 있다.

컴퓨터 한 대만 사용하는 개인 입장에서는 별게 아닐 수 있지만, 수백, 수천개의 컴퓨터를 운영하는 데이터 센터 같은 경우에는 엄청난 리소스 낭비로 이어질 수 있다.

### 가상 머신

이 문제를 해결하기 위해 하이퍼바이저라는 기술이 등장했다. 물리적 리소스를 가상화하여 가상 머신을 생성하고, 여러 개의 운영체제를 동시에 실행할 수 있게 했다.
단편화 문제를 해결하는 것과 유사하게, 리소스를 작은 단위로 나누어 각 운영체제에 적절히 할당함으로써, 리소스를 효율적으로 사용할 수 있게 했다.

### 컨테이너

가상 머신은 가상화된 물리 자원에 운영체제를 띄운다. 즉 운영체제를 여러 개 띄우는 형태다.(커널 위에 또 커널을...) 

꼭 이렇게 할 필요가 있을까? dotCloud 팀에서는 `애플리케이션을 실행시키기 위한 종속성만 가상화`하는게 더 효율적이라는 걸 깨달았다. 그렇게 탄생한 기술이 컨테이너다.

컨테이너는 운영체제를 여러개 실행시키는 게 아니라, `호스트 운영체제의 커널을 그대로 사용`하여 그 위에서 `격리된 환경을 구축`한다. 하나의 운영체제지만, 마치 여러 개의 운영체제에서 동작하는 것 같은 가상 실행 환경을 제공한다.

기존 하이퍼바이저와 다르게 `Guest OS`를 실행하는 대신에 `호스트 OS 커널`을 사용해서 `격리된 여러 개의 컨테이너`를 실행한다.

그래서 기존의 가상화에 비해 컨테이너화가 더 가볍고 효율적이다.

### 그래서 왜 쓰는거야?
- 물리 자원을 더 효율적으로 사용하기 위해서. 
- 컨테이너는 `프로그램 단위로 경량화`된 가상화 기술. 물리 자원을 `애플리케이션에 필요한 만큼`만 활용.

---

## 기본 개념과 구조

### 단일 애플리케이션 프로세스 
- 컨테이너 안에는 여러 애플리케이션을 실행시킬 수 있지만 원칙적으로 하나의 컨테이너에는 하나의 애플리케이션을 실행시키는 게 좋다.
- 컨테이너를 만드는 비용이 아주 저렴하기 때문에, 복잡한 컨테이너를 하나 만드는 것 보다 단순한 컨테이너를 여러개 만드는 것이 더 효율적이고 변경도 쉽다.

### 기반 기술
- 컨테이너화가 가능하게 만드는 기반 기술은 linux 환경에서 제공되는 `namespace`와 `cgroups`이다.
- cgroup
    - cgroup은 프로세스들의 자원의 사용을 제한하고 격리시키는 기술이다.
- namespace
    - 커널 리소스를 분할해서 한 프로세스 집단이 한 리소스 집합을 보고, 다른 프로세스 집합이 다른 리소스 집합을 볼 수 있도록 하는 기술이다.

### 구성 요소
- 도커 데몬
    - dockerd로 불림
    - 도커 엔진의 핵심 백그라운드 프로세스 
    - 컨테이너 생성, 관리, 모니터링, 삭제 작업 수행
- 도커 클라이언트
    - docker 명령어를 도커 데몬에 전달
- 도커 이미지
    - 애플리케이션과 애플리케이션에 필요한 모든 종속성을 포함한 불변의 파일 시스템
    - 이미지는 여러 layer 계층으로 구성, 각 계층은 이전 계층 기반
- 도커 컨테이너
    - 도커 이미지를 실행한 상태
- 도커 레지스트리
    - 도커 이미지를 저장하고 배포하는 역할
    - 도커 허브와 같은 public registry도 있고 private registry도 있음

### 도커 엔진 작동
- 이미지 빌드 
- 컨테이너 실행
- 컨테이너 관리

### 도커 엔진 장점
- 격리 환경
    - 컨테이너는 서로 격리되어 애플리케이션 간의 충돌을 방지
- 이식성
    - 도커 이미지는 어디서나 동일하게 실행 
    - 개발 환경과 운영 환경의 차이를 줄여준다
- 효율성
    - 가상 머신보다 경량화되어, 자원을 더 효율적으로 사용
- 확장성
    - 도커 이미지로 쉽게 확장 가능, 오케스트레이션 도구로 쉽게 관리할 수도 있음

---
# 참고
- [가상화](https://www.nutanix.com/kr/info/virtualization)
- [하이퍼바이저](https://www.nutanix.com/kr/info/hypervisor)
- [AWS 하이퍼바이저](https://aws.amazon.com/ko/what-is/hypervisor/)
- [도커와 컨테이너](https://colevelup.tistory.com/30)
- [namespace와 cgroup](https://nginxstore.com/blog/kubernetes/%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4%EC%99%80-cgroup%EC%9D%80-%EB%AC%B4%EC%97%87%EC%9D%B4%EB%A9%B0-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%A9%EB%8B%88%EA%B9%8C/)