# 웹 서버 역사
- CSAPP의 프록시 서버 과제를 수행해보면서, CGI라는 것을 알게 되었다. WAS, 웹 서버, 톰캣, nginx 등 Spring을 처음에 익힐 때 헷갈렸던 개념들이 CGI를 접하고 나서 왜 이 기술들이 개발되었는지 이해가 되었고, 퍼즐이 맞춰지듯 개념들이 분명해쟜다. 처음에는 웹서버로 시작했던 것이 점차 기능이 확장되면서 저런 기술들이 등장하게 된 건데, 이 역사를 모른 상태에서 해당 기술들의 차이를 이해하는 데에는 한계가 있었던 것이었다.

# 웹(1989, 1996)

웹(World Wide Web)은 1989년 `팀 버너스 리`가 유럽 입자 물리 연구소(CERN)에서 연구원들끼리 정보 공유를 더 쉽게 하기 위해 `하이퍼텍스트 시스템`을 도입하여 개발했다. 문서를 서로 연결시키는 웹의 핵심 기능인 하이퍼텍스트(`HTTP`), 웹 상에서 문서를 인식하기 위한 `URI`, 그리고 문서를 화면에 보여주는 문법인 `HTML` 이 세 기능을 가지고 최초의 웹이 탄생했다.

처음 HTTP/0.9 버전에는 GET 메서드 뿐이었고, 당시 브라우저는 텍스트를 화면에 보여주는 기능만 가지고 있었다. 또한 1991년에야 미국 정부에서 인터넷을 상업적으로 사용하는 것을 허용했고 그 전까지는 인터넷이로 대중적으로 널리 보급되지 않았엇다. 이러한 이유로 웹은 지금처럼 널리 사용되지는 않았다. 

1991년 인터넷의 상업화, 1993년 `Mosaic`, 1994년 `넷스케이프 내비게이터`, 1995년 `윈도우 95`와 `인터넷 익스플로러`가 등장하면서 웹은 급속도로 퍼지기 시작했다. 그리고 1996년에 `HTTP/1.0`이 발표되면서 점차 현대의 웹의 모습을 갖추게 되었다.

# 웹 서버(1995)

웹 서버란 말 그대로 웹 문서를 전달해주는 서버다. HTML 문서의 하이퍼텍스트를 클릭했을 때, 해당 URI의 웹 페이지를 웹 서버에 요청하고, 웹 서버는 해당 웹 페이지를 브라우저에게 전송한다. 이러한 통신은 HTTP 포맷에 맞추어 이루어진다. 이것이 웹 서버의 근간이다. 아래 다시 다루겠지만, 이러한 기본적인 웹 서버의 기능에 CGI나 WAS가 붙으면서 현재의 웹 서버 환경이 만들어진 것이다.

최초의 웹 서버는 팀 버너스 리가 만든 `CERN http`다. 이건 기능이 많이 부족했고 널리 사용되지는 않았다. `Mosaic`을 만든 `NCSA`(미국 국립 슈퍼컴퓨터 응용 연구소)에서는 `NCSA HTTPd`라는 웹 서버를 만들어서 사용하고 있었는데, 이를 사용하던 개발자들이 NCSA HTTPd를 개선하는 오픈 소스 프로젝트로 시작된 것이 Apache 프로젝트이다. 그리고 1995년 `Apache HTTP Server`가 등장하게 되었다. Apache HTTP Server는 오픈 소스이면서, 확장성, 이식성이 뛰어났기 때문에 웹 서버가 대중화되고 웹 표준이 자리 잡는 데 큰 기여를 했다. 

# CGI(1993)

웹 서버는 URI에 해당하는 정적인 HTML 파일을 찾아 전송해주는 프로그램이었다. 하지만 자연스럽게 사용자의 요구에 맞게 동적으로 컨텐츠를 생성하는 기능이 필요해졌고, 그에 대한 대응으로 웹 서버에서, 사용자의 요청에 맞춰 동적으로 output을 만들어주는 외부 프로그램을 실행시키고 그 결과를 받아 응답하는 형태의 `CGI`(Common Gateway Interface)가 도입되었다. 

본격적인 표준 CGI는 1993년 NCSA에서 Mosaic을 개발하면서 만들어졌다. 이 때 만들어진 CGI가 웹 서버와 외부 프로그램 간의 표준 인터페이스로 자리잡게 되었다.

Common Gateway Interface라는 CGI의 이름에서도 알 수 있듯, CGI는 웹 서버와 외부 프로그램 사이에 input과 output을 주고 받는 인터페이스를 표준화한 것이다. 외부 프로그램의 결과를 웹 서버가 받아 보는 구현 방법은, 외부 프로그램을 생성할 때, dup2와 같은 시스템 콜을 사용해서 입출력 스트림을 재지정하는 것이다. 외부 프로그램을 자식 프로세스로 생성하고, 자식 프로세스의 표준 입력을 웹 서버의 요청으로, 자식 프로세스의 표준 출력을 웹 서버의 응답으로 스트림을 재지정하여 CGI를 구현할 수 있다.

# CGI의 한계

CGI는 프로그램을 새로 실행시키는 방식으로 동작하다보니, 요청이 많아 졌을 때 성능 부하가 심했다. 이를 개선하기 위해 `nginx`나 `tomcat`이 등장하게 되었다.

nginx는 CGI처럼 새로운 프로세스를 생성하지 않는다. 요청 마다 매번 프로세스를 생성하지 않고, 백엔드 서버 프로그램(Tomcat, PHP-FPM 등)을 미리 실행해둔다. Nginx는 클라이언트의 요청을 받아 이미 실행 중인 백엔드 서버 프로그램의 프로세스에 요청을 전달하고 응답을 받아 클라이언트에게 전달해줄 뿐이다. 이러한 형태를 `리버스 프록시`라고 한다. 기존의 forward proxy와는 달리 클라이언트가 백엔드 서버에 요청하는 것이 아니라 프록시 서버인 nginx에 직접 요청을 하여 방향이 거꾸로 되었다는 의미로 리버스 프록시라고 부른다.

또한 nginx는 단일 스레드로 실행되는 이벤트 루프에서 요청을 순서대로 받고, 해당 요청들을 새로운 스레드를 생성하여 실행시킨다. 이렇게 새로운 스레드를 생성하여 바로 해당 요청을 비동기적으로 실행시키기 때문에 빠르게 동시적으로 요청을 처리 시킬 수 있다. 또한 백엔드 서버로 부터의 응답을 기다리지 않고, 그 동안 다른 요청들을 비동기적으로 실행시킬 수 있다. 때문에 기존의 프로세스를 실행시키던 방식에 비해 성능적으로 크게 향상되었다.

tomcat은 스레드 풀을 사용한다. 미리 정의되어 있는 개수의 스레드를 생성해 놓고, 요청이 들어오면 idle 상태의 스레드에 해당 요청을 할당하여 처리하는 방식이다. 스레드를 미리 생성해 놓고, 사용하지 않는 스레드를 재사용하면서 동시 처리 성능을 크게 향상시켰다. tomcat만 사용하여 웺 서버를 운영할 수도 있고, nginx의 다양한 기능들(로드 밸런싱, 보안 설정 등)을 사용하기 위해 함께 사용할 수도 있다. 중요한 건, 해당 기술들의 목적과 정확한 동작의 이해를 하는 것이고, 이 목적을 생각하면서 기술을 조합해서 사용하는 것이다.

FastCGI라는 것도 개발되었는데, 프로세스를 매번 생성하는 것이 아니라, 한 번 만들어 놓은 프로세스를 재활용하는 방식이다. 하지만 스레드를 사용해서 동시 처리 성능을 높인 nginx나 tomcat에 비해 성능적으로 부족할 수 밖에 없기 때문에 주류는 아니다.

# WAS(Web Application Server) 새로운 개념의 웹 서버 등장

웹서버는 웹 페이지를 제공하기 위해 만들어졌기 때문에 당연하게도 페이지를 찾고, load해서 응답으로 보내 주는 정적 처리만 하면 되었다. 하지만 이후에 동적인 컨텐츠에 대한 수요가 생겨 억지로 CGI라는 인터페이스를 추가하여 웹서버에 붙여서 사용했었다. 전형적인 클루지다.

이런 진화적인 형태에서 벗어나, 이 모든 웹서버에 대한 수요를 처리하기 위해 탄생한 게 `WAS`다. 단순히 정적인 콘텐츠를 찾아 전달하는 역할에서 벗어나, 요청에 해당하는 로직을 수행하고, 그 결과를 반환해 주는 하나의 애플리케이션으로서의 역할을 수행하는 서버가 탄생한 것이다. 

최초의 WAS는 1990년대 중반에 등장한 Netscape Enterprise Server이다. 넷스케이프가 서버에서 동적 웹 애플리케이션을 구동하기 위해 개발되었다. 이러한 기술이 점차 발전하여 Java 진영에서는 서블릿이라는 기술이 탄생했다. 서블릿은 Tomcat이라는 서블릿 컨테이너 환경에서 실행되고, 이 둘이 합쳐져서 WAS의 역할을 수행한다.

스프링은 웹 애플리케이션에서 사용하는 객체들의 의존성을 스프링 빈 컨테이너라는 개념으로 관리해주는 기능이 추가된 웹 애플리케이션이고, WAS의 동작은 톰캣과 서블릿을 그대로 사용한다. 정확히는 서블릿을 래핑한 프레임워크고, 서블릿과 마찬가지로 톰캣 환경에서 실행된다. 스프링부트는 톰캣이라는 서블릿 실행환경까지 함께 jar의 형태로 만들어줄 뿐이다.


# RESTful(2000)

웹이 널리 사용되면서, HTTP의 사용 방법에 대한 고민도 함께 이루어졌다. HTTP는 리소스를 어떻게 식별하고 가져오는지에 대한 통신 규약일 뿐, 이 규약을 어떻게 사용해야 한다는 규칙은 고안해내지 못했다. 똑같은 리소스를 가져오더라도 다른 HTTP 메서드와 다른 URI로 일관되지 못한 방법으로 가져올 수 있었다. 이는 HTTP를 사용하는 사람들끼리 혼란을 일으킬 수 있었고, 웹 표준의 사용 방법에 대한 일관되고 체계적인 방법이 필요했다.

`로이 필딩`은 2000년에 박사 논문을 통해 REST라는 개념을 정의했다. 어떻게 리소스를 URI로 정의해야 할지, 표준 HTTP 메서드를 활용해야 할지, 리소스를 조작하는 효율적인 방법들을 REST를 통해 제안했다. 로이 필딩은 HTTP/1.1 사양의 공동 설계자였고, Apache HTTP Server의 핵심 기여자였다. 자연스럽게 REST는 웹 기술 개발자들에게 주목받게 되었고, 그 효율성을 인정받아 널리 퍼졌다.


# CORS

처음 CORS를 접했을 때, 이게 왜 있어야 되는지 이해가 잘 안됐다. 지금은 웹 서버가 웹 애플리케이션으로서 동작하면서, 같은 출처가 아닌 경우여도 요청을 주고 받는 경우가 많기 때문이다. 오히려 이러한 상황이 default가 되어 버렸다. 하지만 이번에 웹 서버의 탄생과 발전 과정을 찾아보면서 CORS의 존재 이유도 더 확실하게 이해할 수 있게 되었다. 과거에는 기본적으로 웹서버와 프런트 서버가 일치했었고, AJAX의 발전으로 브라우저에서 웹서버에 데이터를 따로 요청하는 경우가 생기면서, 다른 출처에서 해당 API를 호출해서 생기는 보안 문제가 발생하게 된 것이다. 
