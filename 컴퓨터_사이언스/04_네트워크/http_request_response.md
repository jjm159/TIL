# HTTP Request, Response

[HTTP 완벽 가이드](https://book.naver.com/bookdb/book_detail.nhn?bid=8509980)

이왕 정리하는 거, 위 책의 3장을 참고하여 HTTP 메시지에 대해 요약 정리해 보았다.

## 메시지의 흐름

HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들이다. 이 데이터 블록은 메시지의 내용과 의미를 설명해주는 텍스트 메타 정보로 시작한다. 그리고 그 다음에 선택적으로 데이터가 올 수 있다. 

메시지는 클라이언트 - 프락시 - 서버 사이를 흘러 다닌다. 서버쪽으로 흐르는 것을 인바운드로 이동한다고 하고, 서버에서 클라이언트로 가는 것을 아웃바운드로 이동한다고 한다. 

HTTP 메시지는 모두 다운스트림으로 흐른다. 메시지의 발송자는 수신자의 업스트림이다. 

## 메시지의 각 부분

HTTP 메시지는 단순한, 그리고 데이터의 구조화된 블록이다. 메시지는 시작줄, 헤더, 본문 이렇게 세 부분으로 이루어져 있다. 시작줄은 이 메시지가 어떤 메시지인지 설명해주고, 헤더는 메시지의 속성 값들을 담고 있고, 본문은 데이터를 담는다. 본문은 선택적이라 없을 수도 있다. 

시작줄과 헤더는 줄 단위로 분리된 아스키 문자열이다. 각 줄은 /r(ASCII 13), /n(ASCII 10)으로 구성된 두 글자의 줄바꿈 문자열로 끝난다. 이 두 문자는 합쳐서 CRLF라고 부른다. ( 참고로 개행에 대한 모든 시스템의 표준은 없다. ) 본문은 단순히 데이터 덩어리이다. 텍스트일 수도 있고 이진 데이터일 수도 있다. 또한 그냥 비어있을 수도 있다. 헤더에서 Content-Type은 본문의 데이터가 어떤 데이터인지를 알려준다. 그리고 Content-Length는 본문의 길이를 알려준다. 

## 메시지 문법

모든 메시지는 요청 메시지나 응답 메시지로 분류된다. 요청은 클라이언트가 서버에게 어떤 동작을 요구하는 메시지다. 응답은 서버가 요청의 결과를 클라이언트에게 돌려주는 메시지다. 두 메시지 다 기본적인 구조는 같다. 

- 요청
    
    ```swift
    <메서드> <요청 URL> <버전>/r/n
    <헤더>/r/n
    /r/n
    <엔터티 본문>
    ( 마지막에는 /r/n이 없음. wireshark로 확인해 봄.)
    ```
    
- 응답
    
    ```swift
    <버전> <상태 코드> <사유 구절>/r/n
    <헤더>/r/n
    /r/n
    <엔터티 본문>
    ```
`메서드` : 클라이언트가 서버에게 요구하는 동작을 표현한다. 

`요청 URL` : 요청 대상이 되는 리소스를 지칭하는 URL. 완전한 URL이 아니어도 서버는 자신에게 보내는 걸로 간주하고 자신의 호스트명으로 URL을 완성한다. 

`버전` : 이 메시지에서 사용 중인 HTTP 버전. HTTP/<메이저>.<마이너> 와 같은 형식을 가진다. 메이저, 마이너 모두 정수. 

`상태 코드` : 요청 중에 무엇이 일어났는지 설명하는 세 자리 수. 첫 자리수는 상태의 일반적인 분류(성공, 에러 등)를 나타낸다.

`사유 구절(reason-phrase)` : 상태 코드의 의미를 설명해준다. NOT OK 나 OK 와 같이 표현된다. 

`헤더` : 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나온다. 몇몇 HTTP 버전에서는 응답, 요청에 특정 헤더가 포함되도록 한다.

`엔터티 본문` : 임의의 데이터 블록. 있을 수도 없을 수도. 본문과 헤더는 /r/n으로 구분한다. 즉 헤더 뒤에는 항상 CRLF가 두 번 나오는 것이다. 

*~~메서드와 상태 코드는 생략~~*

## 헤더

헤더는 크게 다섯가지로 분류된다. 

- `일반 헤더` : 클라이언트와 서버 모두 사용한다. 메시지에 대한 기본적인 정보를 제공해준다.
    
    Connection : 요청/응답 연결에 대한 옵션을 지정할 수 있다. 
    
    Date : 메시지의 생성 날짜와 시간을 명시한다.
    
    MIME-Version : 발송자가 사용한 MIME의 버전을 알려준다. 
    
    Trailer chunked transfer : 인코딩된 메시지의 끝 부분에 위치한 헤더들의 목록을 나열하여, 이 헤더들을 모두 받을 때 까지chunked된 메시지들을 받아야 한다고 알려준다. 
    
    Transfer-Encoding : 메시지에 어떤 인코딩이 적용되었는지 명시한다.
    
    Upgrade : 발송자가 업그레이드하길 원하는 새 버전이나 프로토콜을 명시한다. 
    
    Via : 어떤 중개자(프락시, 게이트웨이)를 거쳐 왔는지 보여준다.
    
- `요청 헤더` : 누가 요청을 보낸 건지, 요청의 내용, 클라이언트의 선호나 능력에 대한 정보를 준다. 서버는 이를 활용하여 더 나은 응답을 할 수 있게 도움을 받는다.
    
    Client-IP : 클라이언트 컴퓨터의 IP
    
    From : 클라이언트 사용자의 메일 주소
    
    Host : 요청의 대상이 되는 서버의 호스트 명과 포트
    
    Referer : 현재의 요청 URI가 들어 있었던 문서의 URL을 제공
    
    UA-Color : 클라이언트의 기기가 가진 디스플레이의 색상 능력 정보
    
    UA-CPU : 클라이언트 CPU의 종류와 제조사
    
    UA-Disp : 클라이언트 디스플레이 정보
    
    UA-OS : 클라이언트 기기의 운영체제 버전과 이름
    
    UA-Pixels : 클라이언트 기기의 디스플레이 픽셀 정보
    
    User-Agent : 요청을 보낸 애플리케이션의 이름(브라우저)
    
     
    
     Accept 관련 헤더 
    
    → 서버에게 자신의 선호와 능력을 알려준다. 원하는 것과 원하지 않는 것도 명시. 이 헤더를 참고하여 서버는 응답을 더 똑똑하게 할 수 있다. 
    
    Accept : 서버가 보내도 되는 미디어 종류
    
    Accept-Charset : 서버가 보내도 되는 문자 집합
    
    Accept-Encoding : 서버가 보내도 되는 인코딩
    
    Accept-Language : 서버가 보내도 되는 언어
    
    TE : 서버가 보내도 되는 확장 전송 코딩
    
    조건부 요청 헤더 
    
    → 서버에게 제약 사항을 알려주는 헤더.
    
    Expect : 요청에서 필요로 하는 서버의 행동 열거
    
    If-Match : 여기서 주어진 앤티티 태그와 일치하는 앤티티 태그가 있을 때만 문서를 가져온다. 
    
    If-Modified-Since : 주어진 날짜 이후에 리소스가 변경되지 않았다면 요청을 제한한다. 
    
    If-Node-Match : 문서의 앤터티 태그가 주어진 앤터티 태그와 일치하지 않는 경우에만 문서를 가져온다. 
    
    If-Range : 문서의 특정 범위에 대한 요청을 할 수 있게 해준다. 
    
    If-Unmodified-Since : 주어진 날짜 이후에 리소스가 변경되었다면 요청을 제한한다. 
    
    Range : 서버가 범위 요청을 지원한다면 리소스에 대한 특정 범위를 요청한다. 
    
    요청 보안 헤더 
    
    → HTTP는 자체적으로 요청을 위한 간단한 인증 요구/응답 체계를 가진다. 클라이언트가 리소스에 접근하기 전에 자신을 입증하게 함으로써 트랜젝션을 더 안전하게 만드는 것이 목적이다. 
    
    Authorization : 클라이언트가 서버에게 제공하는 인증 그 자체에 대한 정보
    
    Cookie : 클라이언트가 서버에게 토큰을 전달할 때 사용한다. 
    
    Cookie2 : 요청자가 지원하는 쿠키의 버전을 알려줄 때 사용. 
    
    프락시 요청 헤더 
    
    → 프락시의 기능을 돕기 위해 사용하는 헤더 
    
    Max-Forwards : 요청이 원 서버로 가는 과정에서 다른 프락시나 게이트웨이로 전달될 수 있는 최대 횟수. TRACE 메서드와 함께 사용.
    
    Proxy-Authorization : Authorization과 같으나 프락시에서 인증할 때 쓰인다.
    
    Proxy-Connection : Connection과 같으나 프락시에서 연결을 맺을 때 쓰인다. 
    

- `응답 헤더` : 누가 응답을 보내는지, 응답자의 능력은 얼마나 되는지, 응답에 대한 특별한 설명 등을 클라이언트에게 제공해준다. 이 헤더들은 클라이언트가 응답을 더 잘 다루고 더 나은 요청을 할 수 있게 도와준다.
    
    
    Age : 응답이 얼마나 오래되었는지 
    
    Public : 서버가 특정 리소스에 대해 지원하는 요청 메서드의 목록
    
    Retry-After : 현재 리소스가 사용불가능한 상태일 때, 언제 가능해지는지 날짜 혹은 시간 명시
    
    Server : 서버 애플리케이션의 이름과 버전
    
    Warning : 사유 구절에 있는 것보다 더 자세한 경고 메시지 
    
     협상 헤더 
    
    → 서버가 프랑스어와 독일어 모두 응답으로 가능할 때 어느 것으로 할지 협상 가능한 리소스에 대한 협상 정보 제공
    
    Accept-Ranges : 서버가 자원에 대해 받아들일 수 있는 범위의 형태.
    
    Vary : 서버가 확인해 보아야 하고 그렇기 때문에 응답에 영향을 줄 수 있는 헤더들의 목록. 예) 서버가 클라이언트에게 응답을 줄 때 가장 적절한 HTTP 버전을 선택하기 위해 살펴보아야할 헤더들의 목록.
    
     응답 보안 헤더
    
    Proxy-Authenticate : 프락시에서 클라이언트로 보낸 인증요구의 목록.
    
    Set-Cookie : 진짜 보안 헤더는 아니지만 보안에 영향을 줄 수 있다. 서버가 클라이언트를 인증할 수 있도록 클라이언트 측에 토큰을 설정하기 위해 사용한다. 
    
    Set-Cookie2 : 위 헤더와 비슷하게 RFC 2965로 정의된 쿠키. 
    
    WWW-Authenticate : 서버에서 클라이언트에게 보낸 인증 요구의 목록.
    

- `엔터티 헤더` : 엔터티 본문에 대한 헤더. 본문에 들어있는 데이터의 타입과 길이를 알려준다. 또한 해당 리소스에 요청할 수 있는 유효한 메서드들까지 유용한 정보들을 제공해준다. 일반적으로 엔터티 헤더에는 자신이 다루고 있는 것이 무엇인지 수신자에게 알려준다.
    
    
    Allow : 이 엔터티에 대해 수행될 수 있는 요청 메서드들을 나열하여 알려준다. 
    
    Location : 클라이언트에게 실제 엔터티의 위치가 어디인지 알려준다. 수신자에게 리소스에 대한 새로운 URL을 알려줄 때 사용한다. 
    
     **콘텐트 헤더 : 엔터티의 콘텐츠에 대한 구체적 정보를 제공한다.**
    
    Content-Base : 본문에서 사용된 상대 URL을 계산하기 위한 기저 URL
    
    Content-Encoding : 본문에 적용된 인코딩
    
    Content-Language : 본문을 이해하는데 가장 적절한 자연어
    
    Content-Length : 본문의 길이나 크기
    
    Content-Location : 리소스의 실제 위치
    
    Content-MD5 : 본문의 MD5 체크섬
    
    Content-Range : 전체 리소스에서 이 엔터티가 해당하는 범위를 바이트 단위로 표현
    
    Content-Type : 보문이 어떤 종류의 객체인지
    
     엔터티 캐싱 헤더 : 일반 캐싱 헤더는 어떻게 캐시가 되어야 하는지에 대해 명시한다. 엔터티 캐싱 헤더는 엔터티의 캐싱에 대한 정보를 제공한다. 캐시된 사본이 아직 유효한지, 캐시된 리소스가 더 이상 유효하지 않게 되는 시점을 더 잘 추정하기 위한 단서라든지. 
    
- `확장 헤더` : 아직 표준이 안된 비표준 헤더다.

---
### 참고
[HTTP 헤더](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers)

[HTTP란? (HTTP Message Format, Request Message & Response Message)](https://cornswrold.tistory.com/285)

[HTTP - Hypertext Transfer Protocol](https://www.w3.org/Protocols/)